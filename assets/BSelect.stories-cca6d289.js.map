{"version":3,"file":"BSelect.stories-cca6d289.js","sources":["../../src/components/BSelect.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport {\n  useValidationField,\n  type ValidationRule,\n} from '@/composables/Validation';\nimport {\n  ensureVisiblePosition,\n  lockScrollBody,\n  resetPosition,\n  unlockScrollBody,\n} from '@/helpers/ComponentHelper';\nimport type { BSelectProps, DisplayItem } from '@/types';\nimport { v4 as uuid } from 'uuid';\nimport {\n  computed,\n  nextTick,\n  onBeforeUnmount,\n  onMounted,\n  ref,\n  watch,\n} from 'vue';\nimport { useI18n } from 'vue-i18n';\nimport BErrorMessage from './BErrorMessage.vue';\nimport BLabel from './BLabel.vue';\nimport BTextField from './BTextField.vue';\n\n/**\n * Props\n */\nconst props = withDefaults(defineProps<BSelectProps>(), {\n  inputId: '',\n  label: '',\n  disabled: false,\n  placeholder: '',\n  valueCssClass: '',\n  menuCssClass: '',\n  validationRules: undefined,\n  required: false,\n  requiredErrorMessage: '',\n  hideDetails: false,\n  allowInput: false,\n});\n\n/**\n * Events\n */\nconst emit = defineEmits([\n  'update:modelValue',\n  'change',\n  'open',\n  'close',\n  'change:input',\n]);\n\n/**\n * Data\n */\nconst selectEl = ref<HTMLElement | null>(null);\nconst inputRef = ref<InstanceType<typeof BTextField> | null>(null);\nconst selectMenuEl = ref<HTMLElement | null>(null);\nconst selectMenu = ref(false);\nconst { t } = useI18n();\nconst validateRequired: ValidationRule = {\n  validateRule: (val) => !!val,\n  errorMessage: () =>\n    props.requiredErrorMessage || t('ds.global.field_required'),\n};\nconst inputText = ref('');\nconst selectedItem = ref<DisplayItem>();\nconst id = computed(() => props.inputId || `id-${uuid()}`);\nconst value = computed({\n  get() {\n    return props.modelValue;\n  },\n  set(val) {\n    emit('update:modelValue', val);\n  },\n});\nconst btnCssClass = computed(() => {\n  let result = `ds-border ds-drop-shadow-light ds-text-sm ds-h-[40px] ds-px-3 ds-rounded-lg ds-block ds-w-full ds-inline-flex ds-items-center ds-justify-between `;\n  result += props.disabled\n    ? `ds-cursor-not-allowed ds-bg-[#f2f2f2] ds-text-black/[0.4] `\n    : `ds-bg-white ds-text-black/[0.85] `;\n  result += !validationResult.value.valid\n    ? `ds-border-error focus:ds-ring-1 focus:ds-ring-error `\n    : `ds-border-black/10 focus:ds-border-focus focus:ds-ring-1 focus:ds-ring-focus `;\n\n  return result;\n});\nconst vRules = computed(() => {\n  let result: ValidationRule[] = [];\n\n  if (props.required) {\n    result.push(validateRequired);\n  }\n  if (props.validationRules) {\n    result = result.concat(props.validationRules);\n  }\n\n  return result.length ? result : undefined;\n});\n\nconst { validate, validationResult } = useValidationField(\n  id.value,\n  value,\n  vRules.value\n);\n\n/**\n * Watch\n */\nwatch(selectMenu, (val) => {\n  if (val) {\n    lockScrollBody();\n    ensureMenuPosition();\n    emit('open');\n  } else {\n    unlockScrollBody();\n    resetMenuPosition();\n    emit('close');\n  }\n});\nwatch(value, () => {\n  ensureSelectedItem();\n  ensureInputText();\n});\nwatch(\n  () => props.items,\n  () => {\n    if (value.value && !selectedItem.value?.value) {\n      ensureSelectedItem();\n      ensureInputText();\n    }\n  },\n  {\n    deep: true,\n  }\n);\n\n/**\n * Methods\n */\nconst ensureSelectedItem = () => {\n  selectedItem.value = props.items.find((i) => i.value === value.value);\n};\nconst ensureInputText = () => {\n  if (props.allowInput) {\n    inputText.value = selectedItem.value?.text || '';\n  }\n};\nconst initPressEscapeEventListener = () => {\n  document.addEventListener('keydown', closeOnEscapePressed);\n};\nconst closeOnEscapePressed = (event: KeyboardEvent) => {\n  if (event.key === 'Escape') {\n    closeSelectMenu();\n  }\n};\nconst initClickOutsideEventListener = () => {\n  document.addEventListener('click', closeOnClickOutside);\n};\nconst closeOnClickOutside = (event: any) => {\n  const refs = [selectEl.value, selectMenuEl.value];\n  const withinBoundaries = refs.some((r) => event.composedPath().includes(r));\n  if (!withinBoundaries) {\n    closeSelectMenu();\n  }\n};\nconst onClickItem = (item: DisplayItem) => {\n  value.value = item.value;\n  closeSelectMenu();\n  emit('change', item.value);\n  nextTick(() => {\n    validate();\n  });\n};\nconst ensureMenuWidth = (parentEl: HTMLElement, menuEl: HTMLElement) => {\n  menuEl.style.width = `${parentEl.offsetWidth}px`;\n};\nconst ensureMenuPosition = () => {\n  nextTick(() => {\n    ensureVisiblePosition(selectEl.value!, selectMenuEl.value!);\n    ensureMenuWidth(selectEl.value!, selectMenuEl.value!);\n  });\n};\nconst resetMenuPosition = () => {\n  resetPosition(selectEl.value!, selectMenuEl.value!);\n};\nconst onChangeInputText = (text: string) => {\n  emit('change:input', text);\n};\nconst closeSelectMenu = () => {\n  selectMenu.value = false;\n  inputRef.value?.blur();\n  ensureInputText();\n};\nconst init = () => {\n  ensureSelectedItem();\n  ensureInputText();\n};\ninit();\n\n/**\n * Lifecycle Hooks\n */\nonMounted(() => {\n  initPressEscapeEventListener();\n  initClickOutsideEventListener();\n});\nonBeforeUnmount(() => {\n  document.removeEventListener('keydown', closeOnEscapePressed);\n  document.removeEventListener('click', closeOnClickOutside);\n  unlockScrollBody();\n  // Make sure dropdown menu unmounted with itself\n  resetMenuPosition();\n});\n\ndefineExpose({ validate, selectMenu });\n</script>\n\n<template>\n  <div>\n    <div ref=\"selectEl\">\n      <BLabel :id=\"id\" :label=\"label\" :required=\"required\" />\n\n      <BTextField\n        v-if=\"props.allowInput\"\n        :id=\"id\"\n        ref=\"inputRef\"\n        v-model=\"inputText\"\n        :append-icon=\"`fa-solid fa-caret-down ds-transition-transform ${\n          selectMenu ? 'ds-rotate-180' : ''\n        }`\"\n        :disabled=\"props.disabled\"\n        :placeholder=\"props.placeholder\"\n        hide-details\n        @focus=\"selectMenu = true\"\n        @click:append=\"inputRef?.focus()\"\n        @update:model-value=\"onChangeInputText\"\n      />\n      <button\n        v-else\n        :id=\"id\"\n        :class=\"btnCssClass\"\n        :disabled=\"props.disabled\"\n        type=\"button\"\n        @click=\"selectMenu = !selectMenu\"\n      >\n        <span :class=\"valueCssClass\" class=\"ds-truncate\">\n          <span v-if=\"selectedItem?.text\">{{ selectedItem?.text }}</span>\n          <span v-else class=\"ds-text-black/[0.4]\">\n            {{ props.placeholder }}\n          </span>\n        </span>\n        &nbsp;\n        <span\n          :class=\"`${selectMenu ? 'ds-rotate-180' : ''}`\"\n          class=\"fa-solid fa-caret-down ds-text-base ds-transition-transform\"\n        >\n        </span>\n      </button>\n\n      <div\n        v-show=\"selectMenu\"\n        :id=\"`${id}Menu`\"\n        ref=\"selectMenuEl\"\n        :class=\"menuCssClass\"\n        :data-cy=\"$attrs['data-cy'] ? `${$attrs['data-cy']}Menu` : undefined\"\n        :data-ut=\"$attrs['data-ut'] ? `${$attrs['data-ut']}Menu` : undefined\"\n        class=\"ds-absolute ds-z-50 ds-min-w-[8rem] ds-py-1\"\n      >\n        <div\n          class=\"ds-max-h-72 ds-overflow-y-auto ds-rounded-lg ds-bg-white ds-shadow\"\n        >\n          <ul class=\"ds-py-1 ds-text-sm ds-text-black/[0.85]\">\n            <li\n              v-for=\"(item, index) in items\"\n              :key=\"`item${index}`\"\n              class=\"ds-cursor-pointer\"\n              @click=\"onClickItem(item)\"\n            >\n              <a\n                :class=\"\n                  item.cssClass +\n                  `${item.value === value ? ' ds-bg-gray-150' : ''}`\n                \"\n                class=\"ds-block ds-px-4 ds-py-2 hover:ds-bg-gray-150\"\n              >\n                {{ item?.text }}\n              </a>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n\n    <BErrorMessage\n      v-if=\"!hideDetails\"\n      :error-message=\"validationResult.errorMessage()\"\n      class=\"ds-mt-1\"\n      prepend-icon=\"fa-solid fa-circle-exclamation\"\n    />\n  </div>\n</template>\n"],"names":["selectEl","ref","inputRef","selectMenuEl","selectMenu","t","useI18n","validateRequired","val","props","inputText","selectedItem","id","computed","uuid","value","emit","btnCssClass","result","validationResult","vRules","validate","useValidationField","watch","lockScrollBody","ensureMenuPosition","unlockScrollBody","resetMenuPosition","ensureSelectedItem","ensureInputText","_a","i","initPressEscapeEventListener","closeOnEscapePressed","event","closeSelectMenu","initClickOutsideEventListener","closeOnClickOutside","r","onClickItem","item","nextTick","ensureMenuWidth","parentEl","menuEl","ensureVisiblePosition","resetPosition","onChangeInputText","text","onMounted","onBeforeUnmount","__expose"],"mappings":"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"}
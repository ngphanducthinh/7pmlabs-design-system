{"version":3,"file":"Validation-f8e18c0f.js","sources":["../../src/composables/Validation.ts"],"sourcesContent":["import { inject, onBeforeUnmount, provide, ref, type Ref } from 'vue';\n\n/**\n * Types\n */\n// eslint-disable-next-line no-unused-vars\nexport type ValidationRuleFunction = (val: any) => boolean;\nexport type ValidationErrorMessageFunction = () => string;\nexport interface ValidationRule {\n  validateRule: ValidationRuleFunction;\n  errorMessage: ValidationErrorMessageFunction;\n}\nexport interface ValidationResult {\n  validate: () => void;\n  fieldValue: Ref<any>;\n  valid: boolean;\n  errorMessage: ValidationErrorMessageFunction;\n}\n\nexport const FormValidationProviderName = 'formValidation';\n\n/**\n * ValidationForm\n * @returns\n */\nexport function useValidationForm() {\n  let validationForm = inject<\n    Record<string, Ref<ValidationResult>> | undefined\n  >(FormValidationProviderName, undefined);\n  if (!validationForm) {\n    validationForm = {};\n    provide<Record<string, Ref<ValidationResult>>>(\n      FormValidationProviderName,\n      validationForm\n    );\n  }\n\n  const validateAll = (): boolean => {\n    if (validationForm) {\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      const vList = Object.entries(validationForm).map(([key, value]) => {\n        value.value.validate();\n        return value.value.valid;\n      });\n      return vList.every((v) => v);\n    }\n    return false;\n  };\n  const resetAll = () => {\n    if (validationForm) {\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      Object.entries(validationForm).forEach(([key, value]) => {\n        value.value.valid = true;\n        value.value.errorMessage = () => '';\n      });\n    }\n  };\n\n  return {\n    validationForm,\n    validateAll,\n    resetAll,\n  };\n}\n\n/**\n * Validation Field\n * @param key\n * @param fieldValue\n * @param validationRules\n * @returns\n */\nexport function useValidationField(\n  key: string,\n  fieldValue: Ref<any>,\n  validationRules: ValidationRule[] | undefined\n) {\n  const validationResult = ref<ValidationResult>({\n    validate: () => {},\n    fieldValue,\n    valid: true,\n    errorMessage: () => '',\n  });\n\n  const formValidations = inject<\n    Record<string, Ref<ValidationResult>> | undefined\n  >(FormValidationProviderName, undefined);\n  if (formValidations) {\n    formValidations[key] = validationResult;\n  }\n\n  onBeforeUnmount(() => {\n    if (formValidations) {\n      delete formValidations[key];\n    }\n  });\n\n  /**\n   * Validate field value by a list of rules\n   * @returns\n   */\n  const validate = () => {\n    if (!validationRules) {\n      return;\n    }\n\n    validationResult.value.valid = true;\n    validationResult.value.errorMessage = () => '';\n\n    for (let i = 0; i < validationRules.length; i++) {\n      const result = validationRules[i].validateRule(fieldValue.value);\n\n      if (!result) {\n        validationResult.value.valid = false;\n        validationResult.value.errorMessage = validationRules[i].errorMessage;\n        return;\n      }\n    }\n  };\n\n  validationResult.value.validate = validate;\n\n  return {\n    validate,\n    validationResult,\n  };\n}\n"],"names":["FormValidationProviderName","useValidationField","key","fieldValue","validationRules","validationResult","ref","formValidations","inject","onBeforeUnmount","validate","i"],"mappings":"gEAmBO,MAAMA,EAA6B,iBAqD1B,SAAAC,EACdC,EACAC,EACAC,EACA,CACA,MAAMC,EAAmBC,EAAsB,CAC7C,SAAU,IAAM,CAAC,EACjB,WAAAH,EACA,MAAO,GACP,aAAc,IAAM,EAAA,CACrB,EAEKI,EAAkBC,EAEtBR,EAA4B,MAAS,EACnCO,IACFA,EAAgBL,CAAG,EAAIG,GAGzBI,EAAgB,IAAM,CAChBF,GACF,OAAOA,EAAgBL,CAAG,CAC5B,CACD,EAMD,MAAMQ,EAAW,IAAM,CACrB,GAAKN,EAIL,CAAAC,EAAiB,MAAM,MAAQ,GACdA,EAAA,MAAM,aAAe,IAAM,GAE5C,QAASM,EAAI,EAAGA,EAAIP,EAAgB,OAAQO,IAG1C,GAAI,CAFWP,EAAgBO,CAAC,EAAE,aAAaR,EAAW,KAAK,EAElD,CACXE,EAAiB,MAAM,MAAQ,GAC/BA,EAAiB,MAAM,aAAeD,EAAgBO,CAAC,EAAE,aACzD,MACF,EACF,EAGF,OAAAN,EAAiB,MAAM,SAAWK,EAE3B,CACL,SAAAA,EACA,iBAAAL,CAAA,CAEJ"}